machine:
  environment:
    YARN_VERSION: 0.18.1
    PATH: "${PATH}:${HOME}/.yarn/bin:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"
  node:
    version: 6.10.3

general:
  branches:
    only:
      - master

dependencies:
  cache_directories:
    - ~/.cache/yarn
  override:
    - yarn install

# we will always overwrite the production tag with the latest image build
# it saves space in the registry and costs less
# if we need to roll back we do so on github, github will trigger a rebuild and redeploy
# in the future we can tag hashes and clean up old images...
deployment:
  production:
    branch: master
    commands:
      - yarn deploy:production
      - yarn deploy:staging